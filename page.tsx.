'use client';
import { useEffect, useState } from 'react';
type Label = { full_name:string; allergies?:string|null; classroom:string; security_code:string };

export default function PrintLabelsPage() {
  const [labels,setLabels]=useState<Label[]>([]);
  const [guardianTicket,setGuardianTicket]=useState<string[]>([]);

  useEffect(()=>{
    const data=sessionStorage.getItem('labels');
    const parsed: Label[] = data ? JSON.parse(data) : [];
    setLabels(parsed);
    setGuardianTicket(parsed.map(l => `${l.full_name}: ${l.security_code}`));
    setTimeout(()=>window.print(),500);
  },[]);

  return (
    <div className="sheet">
      {labels.map((l,i)=>(
        <div key={i} className="label">
          <div className="name">{l.full_name}</div>
          <div className="row"><b>Salón:</b> {l.classroom}</div>
          <div className="row"><b>Código:</b> {l.security_code}</div>
          {l.allergies ? <div className="allergy">⚠ Alergias: {l.allergies}</div> : null}
        </div>
      ))}
      <div className="label guardian">
        <div className="name">Ticket del Tutor</div>
        {guardianTicket.map((ln,i)=><div key={i} className="row">{ln}</div>)}
      </div>

      <style jsx global>{`
        @page { size: 2in 3in; margin: 0; }
        @media print { body { -webkit-print-color-adjust: exact; } }
        body { margin:0; font-family:-apple-system, Arial, sans-serif; }
        .sheet { display:flex; flex-wrap:wrap; gap:6mm; padding:6mm; }
        .label { width:2in; height:3in; box-sizing:border-box; padding:6mm; border:1px solid #000; display:flex; flex-direction:column; }
        .name { font-size:18pt; font-weight:700; margin-bottom:6px; }
        .row { font-size:12pt; margin-bottom:4px; }
        .allergy { margin-top:auto; font-size:12pt; font-weight:700; color:#b00000; }
        .guardian { border-style:dashed; }
      `}</style>
    </div>
  );
}